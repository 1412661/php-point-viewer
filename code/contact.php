<?php/*	Đây là file hỗ trợ việc gửi tin nhắn của người dùng đến cho người quản lí website. Bạn có thể xem các comment cạnh code để biết thêm chi tiết*/
session_start();include_once('config/config.php');include_once('function/function.php');include_once('class/mysql.php');include_once('class/xtemplate/xtemplate.class.php');if (!RUNTIME_DEV_MODE) {	error_reporting(E_ERROR | E_WARNING | E_PARSE);}page_view(true, false, false);if (RUNTIME_MOBILE_DETECT) {	$tpl = new XTemplate('template/mobile/contact.tpl');} else {	$tpl = new XTemplate('template/contact.tpl');}if ($_POST['submit'] == 'submit') {	if (!var_set($_POST['name'])) {		return_error('Bạn chưa nhập tên !');	} elseif (!var_set($_POST['content'])) {		return_error('Bạn chưa nhập nội dung thư !');	} elseif ($_SESSION['captcha'] != intval($_POST['captcha'])) {		return_error('Bạn đã nhập sai mã xác nhận. Xin vui lòng kiểm tra lại');	} else {		$sql = new MySQL();				$name = sql_filter($_POST['name']);		$address = sql_filter($_POST['address']);		$subject = sql_filter($_POST['subject']);		$content = sql_filter($_POST['content']);		$ip = get_user_ip();		$time = current_time();				$sql->log('NEW CONTACT', null);		$sql->contact2sql($name,$address,$subject,$content,$ip,$time);		$sql->close();				include('class/phpmailer/class.phpmailer.php');		include('class/phpmailer/class.smtp.php');				$mail = new PHPMailer();		$mail->charSet = 'UTF-8';				$body = file_get_contents('template/mail.tpl');		$body = str_replace('{name}', $_POST['name'], $body);		$body = str_replace('{address}', $_POST['address'], $body);		$body = str_replace('{subject}', $_POST['subject'], $body);		$body = str_replace('{content}', $_POST['content'], $body);		$body = str_replace('{ip}', get_user_ip(), $body);		$body = str_replace('{time}', current_time(), $body);		$mail->IsSMTP();		//$mail->IsMail();		//$mail->SMTPDebug = 1;		$mail->SMTPAuth   = true;					//Bật tính năng xác thực SMTP		$mail->SMTPSecure = 'SSL';					//Chuẩn bảo mật SMTP		$mail->Host       = 'relay.jangosmtp.net';	//SMTL Host		$mail->Port       = 25;						//SMTL port: bạn có thể dùng các cổng 25, 587, or 2525.		$mail->Username   = MAIL_SMTP_USERNAME;			//Tên người dùng dịch vụ		$mail->Password   = MAIL_SMTP_PASSWORD;			//Mật khẩu		$mail->From       = MAIL_FROM_ADDRESS;		$mail->FromName   = MAIL_FROM_NAME;							//Tên người gửi		$mail->Subject    = 'PHPPV - You have a new message';	//Tiêu đề thư		$mail->AltBody    = 'New Message';			//Text Body		$mail->WordWrap   = 50;						// set word wrap		$mail->MsgHTML($body);		//$mail->AddReplyTo('quocbao747@gmail.com', 'quocbao747');		//Đính kèm file trong thư gửi đi		//$mail->AddAttachment('template/image/banner1.png');		$mail->AddAddress(MAIL_DES_ADDRESS);		$mail->IsHTML(true); 				//Gửi thư với định dạng HTML				if ($mail->Send()) {			$tpl->assign('script', "alert('Gửi tin nhắn thành công !');\nwindow.close();");		} else {			$tpl->assign('script', "alert('Gửi tin nhắn thất bại !');\nwindow.close();");		}	}}unset($_SESSION['captcha']);$tpl->assign('name', $_POST['name']);$tpl->assign('address', $_POST['address']);$tpl->assign('subject', $_POST['subject']);$tpl->assign('content', $_POST['content']);$tpl->parse('main');
$tpl->out('main');function return_error($error) {	global $tpl;		$tpl->assign('script', 'alert(\''.$error.'\');');}
?>