<?php/*	Đây là file cung cấp chức năng xử lí việc đăng nhập của người quản lí vào hệ thống quản lí website.*/
session_start();include_once('config/config.php');include_once('function/function.php');include_once('class/xtemplate/xtemplate.class.php');include_once('class/mysql.php');if (!RUNTIME_DEV_MODE) {	error_reporting(E_ERROR | E_WARNING | E_PARSE);}$sql = new MySQL();save_user_ip();if (isset($_GET['logout'])) {	if ($_SESSION['login'] == true) {		$sql->log('USER LOGOUT', 'Tên tài khoản: ['.$_SESSION['user'].']');		$_SESSION['login'] = false;		unset($_SESSION['login']);		unset($_SESSION['user']);		outpage(null, 'alert(\'Bạn đã đăng xuất khỏi hệ thống !\')');	} else {		outpage('Bạn chưa đăng nhập vào hệ thống !');	}}if (RUNTIME_MOBILE_DETECT) {	$tpl = new XTemplate('template/mobile/login.tpl');} else {	$tpl = new XTemplate('template/login.tpl');}if ($_SESSION['login'] == true) {	$tpl->parse('main.select_function');} elseif ((!var_set($_POST['username'])) or (!var_set($_POST['pass']))) {	$tpl->parse('main.login');	} else {		//////////////////////////////////////////////////////////		$username = sql_filter($_POST['username']);		$passwword = md5($_POST['pass']);				$search = $sql->setquery('SELECT `username`, `password` FROM `users` WHERE `username` = \''.$username.'\' AND `password` = \''.$passwword.'\'');				if (mysql_num_rows($search) == 1) {			$_SESSION['login'] = true;			$_SESSION['user'] = $username;			$_SESSION['redirect'] = true;			$tpl->parse('main.select_function');			$sql->log('USERS LOGIN', 'Tên tài khoản: ['.$username.']');			header('Location: redirect.php');		} else {			$tpl->assign('alert', 'Đăng nhập thất bại !');			$tpl->parse('main.alert');			$_SESSION['login'] = false;			$tpl->parse('main.login');		}	//////////////////////////////////////////////////////////	}$sql->close();$tpl->parse('main');$tpl->out('main');?>